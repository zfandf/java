<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta id="viewport" name="viewport" content="width=device-width, initial-scale=1.5, minimum-scale=1.0, maximum-scale=1.0" />
<meta name="format-detection" content="telephone=no">
<title>应用列表</title>
<!--[if lte IE 8]>
<script type="text/javascript" src="assets/js/html5.js"></script>s
<![endif]-->
<style type="text/css">
  * { padding:0; margin:0}
  .appdemo {max-width:110px; width:33.3%; list-style:none; display:inline; float:left; margin:10px 0;}

  .app-thumb {text-align:center;}
  .app-img {width:60px; height:60px;}
  .app-name {height:30px; line-height:30px; text-align:center; overflow:hidden; white-space:nowrap; text-overflow:ellipsis;}

  .loading {text-align:center; margin:20px;}
  
</style>
</head>
<body>
	<header></header>
	<section id="J_AppList">
		<h4 class="loading">正在读取数据<img src="assets/image/loading-dir.gif"></h4>
	</section>
	<script type="javascript/template" id="J_AppTmpl">
		<li class="appdemo">
			<p class="app-thumb"><img class="app-img" src="?action=image&path={path}"></p>
			<p class="app-name">{name}</p>
		</li>
	</script>

	<script type="text/javascript">
	var appTmpl = document.getElementById('J_AppTmpl').innerHTML;
	var eListBox = document.getElementById('J_AppList');
	window.onload = function() {
		var url = '?action=app_list';
		var xmlHttp = new XMLHttpRequest();
		xmlHttp.onreadystatechange = function() {
     		if( xmlHttp.readyState == 4  && xmlHttp.status == 200 ) {
     			var oData = JSON.parse(xmlHttp.responseText);
     			console.log(oData);
     			if (oData.code == 0 && oData.apps.length > 0) {
     				console.log(oData.apps);
     				var str = setTemplate(appTmpl, oData.apps);
     				eListBox.innerHTML = str;
     			}

     		}
    	};
    	xmlHttp.open( "GET", url, true );
    	xmlHttp.send( null );
	};

	function setTemplate(sTmpl, oVar){
        var ary = [];
        var more = "", str = "";
        if ((Array.isArray && Array.isArray(oVar)) || oVar instanceof Array) {
            ary = oVar;
        } else if ('object' == typeof(oVar)) {
            ary[0] = oVar;
        }
        for (var i in ary) {
            str = sTmpl;
            for (var prop in ary[i]) {
                var r = new RegExp('{'+prop+'}', 'g');
                var v = ary[i][prop];
                str = str.replace(r, v);
            }
            more += str;
        }
        return more;
    };
	</script>
</body>

</html>

