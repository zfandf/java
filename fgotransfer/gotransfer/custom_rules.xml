<?xml version="1.0" encoding="UTF-8"?>
<project name="custom_rules" >

	<property name="out.apk.dir" value="apk"/>
	
    <target name="override-out"  depends="mkdir" >
        
        <xpath input="AndroidManifest.xml" expression="/manifest/@android:versionName"
			output="manifest.versionName" default="unknown" />
        
        <property
            name="out.final.file"
            location="${out.apk.dir}/${app_name}_${app_channel}_${manifest.versionName}.apk" />
    </target>

    <target name="mkdir" depends="dir-check" unless="dir.exists">
        <mkdir dir="${out.apk.dir}"/>
    </target>
    
    <target name="dir-check">
        <condition property="dir.exists">
            <available file="${out.apk.dir}" type="dir"/>
        </condition>
    </target>
    
    <target
        name="deploy"
        depends="override-out, clean, release" />

</project>